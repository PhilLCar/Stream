#include <filestream.h>

#define TYPENAME FileStream

////////////////////////////////////////////////////////////////////////////////
FileStream *_(Construct)(FILE *stream)
{
  // The user is responsible for setting cod in other cases, but these are obvious
  BASE(1)->cod = stream == stdin || stream == stdout || stream == stderr;
  return (FileStream*)CharStream_Construct(BASE(0), stream);
}

////////////////////////////////////////////////////////////////////////////////
void _(Destruct)()
{
  CharStream_Destruct(BASE(0));
}

////////////////////////////////////////////////////////////////////////////////
void _(Close)()
{
  if (BASE(1)->cod)
  {
    fclose(*BASE(2));
  }
}

////////////////////////////////////////////////////////////////////////////////
int _(Peek)()
{
  int c = fgetc(*BASE(2));

  ungetc(c, *BASE(2));

  return c;
}

////////////////////////////////////////////////////////////////////////////////
int _(Get)()
{
  int c = fgetc(*BASE(2));

  BASE(1)->eos = c == EOF;

  return c;
}

////////////////////////////////////////////////////////////////////////////////
void _(Unget)(int c)
{
  ungetc(c, *BASE(2));
  BASE(1)->eos = 0;
}

////////////////////////////////////////////////////////////////////////////////
void _(Put)(int c)
{
  fputc(c, *BASE(2));
}

#undef TYPENAME
