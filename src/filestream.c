#include <filestream.h>

#define TYPENAME FileStream

////////////////////////////////////////////////////////////////////////////////
FileStream *_(cons)(FILE *stream)
{
  return (FileStream*)CharStream_cons(BASE(0), stream);
}

////////////////////////////////////////////////////////////////////////////////
void _(free)()
{
  CharStream_free(BASE(0));
}

////////////////////////////////////////////////////////////////////////////////
void _(close)()
{
  fclose(*BASE(2));
}

////////////////////////////////////////////////////////////////////////////////
void *_(peek)()
{
  long c = fgetc(*BASE(2));

  ungetc(c, *BASE(2));

  return (void*)c;
}

////////////////////////////////////////////////////////////////////////////////
void *_(get)()
{
  long c = fgetc(*BASE(2));

  BASE(1)->eos = c == EOF;

  return (void*)c;
}

////////////////////////////////////////////////////////////////////////////////
void _(unget)(void *token)
{
  ungetc((long)token, *BASE(2));
  BASE(1)->eos = 0;
}

////////////////////////////////////////////////////////////////////////////////
void _(put)(void *token)
{
  fputc((long)token, *BASE(2));
}