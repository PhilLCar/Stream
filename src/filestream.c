#include <filestream.h>

#define TYPENAME FileStream

////////////////////////////////////////////////////////////////////////////////
FileStream *_(cons)(FILE *stream)
{
  // The user is responsible for setting cod in other cases, but these are obvious
  BASE(1)->cod = stream == stdin || stream == stdout || stream == stderr;
  return (FileStream*)CharStream_cons(BASE(0), stream);
}

////////////////////////////////////////////////////////////////////////////////
void _(free)()
{
  CharStream_free(BASE(0));
}

////////////////////////////////////////////////////////////////////////////////
void _(close)()
{
  if (BASE(1)->cod)
  {
    fclose(*BASE(2));
  }
}

////////////////////////////////////////////////////////////////////////////////
int _(peek)()
{
  int c = fgetc(*BASE(2));

  ungetc(c, *BASE(2));

  return c;
}

////////////////////////////////////////////////////////////////////////////////
int _(get)()
{
  int c = fgetc(*BASE(2));

  BASE(1)->eos = c == EOF;

  return c;
}

////////////////////////////////////////////////////////////////////////////////
void _(unget)(int c)
{
  ungetc(c, *BASE(2));
  BASE(1)->eos = 0;
}

////////////////////////////////////////////////////////////////////////////////
void _(put)(int c)
{
  fputc(c, *BASE(2));
}